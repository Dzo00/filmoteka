var url=location.href;function ajaxPodaci(e){$.ajax({dataType:"json",url:"data/podaci.json",method:"GET",success:e})}function ispisiDDLGodine(){ajaxPodaci(function(e){var a=document.getElementById("filter-godina");IspisiPodatke(izvuciGodine(e),"godineDDL",a)})}console.log(url),$(document).ready(function(){if(SETLocalStorage("filterZanr",""),$.ajax({method:"get",dataType:"json",url:"data/kategorije.json",success:function(e){IspisiPodatke(e,"kategorije",document.getElementById("kategorije"))},error:function(e){console.log(e)}}),-1!=url.indexOf("bookmark.html")){var e=document.getElementById("watchListIspis"),a=GETLocalStorage("watchList");a?ajaxPodaci(function(t){t=t.filter(e=>{for(let t of a)if(e.id==t.id)return!0}),console.log(t),0!=t.length?IspisiPodatke(t,"watchListCard",e):e.innerHTML='<h4 class="text-yellow mt-4">Vaša lista filmova za gledanje je prazna!</h4>'}):e.innerHTML='<h4 class="text-yellow mt-4">Vaša lista filmova za gledanje je prazna!</h4>'}if(-1==url.indexOf("bookmark.html")&&-1==url.indexOf("autor.html")){$.ajax({method:"get",dataType:"json",url:"data/zanr.json",success:function(e){IspisiPodatke(e,"zanr",document.getElementById("zanrovi"))},error:function(e){console.log(e)}}),ispisiDDLGodine(),pocetniIspis();IspisiPodatke([{id:1,tekst:"Najnoviji prvo"},{id:2,tekst:"Najpopularniji"},{id:3,tekst:"Najbolje ocenjeni"}],"sortDDL",document.getElementById("sort-kriterijum"))}$("#btnLog").click(proveraLog),$("#btnReg").click(proverRegister),document.getElementById("search").addEventListener("keyup",NadjiFilm),$(document).on("click","#seeFilter",function(){$("#sidebar").slideToggle("slow")}),$(window).resize(PromeniCSSPoVeliciniEkrana),PromeniCSSPoVeliciniEkrana()});var reEmail,rePassword,FilmoviDiv=document.getElementById("filmovi");function pocetniIspis(){ajaxPodaci(function(e){IspisiPodatke(e,"filmovi",FilmoviDiv)})}function IspisiPodatke(e,a,t){ispis="";let o="<option value='0'>Izaberite</option>";if("watchListCard"==a){for(let t of e)ispis+=MakeProduct(a,t);t.innerHTML=ispis,promeniBookmark(),$(".title-WL").click(pokreniModal),$(".remove").click(ukloniFilm)}else if("sortDDL"==a||"godineDDL"==a){if("filter-godina"==t.id){for(let t of e)o+=MakeProduct(a,t);t.innerHTML=o,$("#filter-godina").change(filterGodine)}else if("sort-kriterijum"==t.id){for(let t of e)o+=MakeProduct(a,t);t.innerHTML=o,$("#sort-kriterijum").change(SortirajPoKriterijumu)}}else if("filmovi"==a){if((e=-1!=url.indexOf("index.html")?e.filter(e=>1==e.kategorijaID):-1!=url.indexOf("serije.html")?e.filter(e=>2==e.kategorijaID):e.filter(e=>3==e.kategorijaID)).length>0){for(let t of e)ispis+=MakeProduct(a,t);t.innerHTML=ispis}else t.innerHTML="<h4>Nema informacija za izabrani sadrzaj!!</h4>";$(".card-title").click(pokreniModal),$(".dodajUWatch").click(function(e){e.preventDefault(),$(this).children().removeClass("far").addClass("fas");let a=$(this).data("film");if(i=GETLocalStorage("watchList"),console.log(i),null!=i){if(i.filter(e=>e.id==a).length>0)return!1;i.push({id:this.dataset.film}),SETLocalStorage("watchList",i),promeniBookmark()}else{let e=[0];e[0]={id:this.dataset.film},SETLocalStorage("watchList",e),promeniBookmark()}});var i=GETLocalStorage("watchList");if(promeniBookmark(),null!=i){let e=$(".dodajUWatch");for(let a of e)for(let e of i)a.dataset.film==e.id&&a.childNodes[0].classList.add("fas")}}else if("zanr"==a){for(let t of e)ispis+=MakeProduct(a,t);t.innerHTML=ispis,$(".zanr-check").click(filterPoZanru)}else{for(let t of e)ispis+=MakeProduct(a,t);t.innerHTML+=ispis,$("#pause").click(function(){$("iframe").attr("src",$("iframe").attr("src"))})}}function GETLocalStorage(e){return"watchList"==e?JSON.parse(localStorage.getItem(e)):"filterGodina"==e?JSON.parse(localStorage.getItem(e)):"filterSort"==e?JSON.parse(localStorage.getItem(e)):"filterZanr"==e?JSON.parse(localStorage.getItem(e)):void 0}function SETLocalStorage(e,a){"watchList"==e?localStorage.setItem(e,JSON.stringify(a)):"filterGodina"==e?localStorage.setItem(e,JSON.stringify(a)):"filterSort"==e?localStorage.setItem(e,JSON.stringify(a)):"filterZanr"==e&&localStorage.setItem(e,JSON.stringify(a))}function promeniBookmark(){var e=GETLocalStorage("watchList");null!=e?($("#bookmarkNumber").prev()[0].classList.add("fas"),$("#bookmarkNumber")[0].innerHTML=e.length):($("#bookmarkNumber").prev()[0].classList.remove("fas"),$("#bookmarkNumber")[0].innerHTML=" ")}function ukloniFilm(){var e=this.dataset.film,a=document.getElementById("watchListIspis"),t=GETLocalStorage("watchList");SETLocalStorage("watchList",t=t.filter(a=>{if(a.id!=e)return a})),0!=t.length?ajaxPodaci(function(e){IspisiPodatke(e=e.filter(e=>{for(let a of t)if(e.id==a.id)return!0}),"watchListCard",a)}):(a.innerHTML='<h4 class="text-yellow mt-4">Vaša lista filmova za gledanje je prazna!</h4>',localStorage.clear("watchList"),promeniBookmark())}function filtritajSortiraj(){var e=GETLocalStorage("filterGodina"),a=GETLocalStorage("filterSort"),t=GETLocalStorage("filterZanr");id=this.value,ajaxPodaci(function(o){let i=o;e&&0!=e&&(i=-1!=url.indexOf("serije.html")?i.filter(a=>a.godina.pocetak==e):i.filter(a=>a.godina==e)),a&&(1==a?i=i.sort((e,a)=>-1!=url.indexOf("serije.html")?e.godina.pocetak>a.godina.pocetak?-1:1:e.godina>a.godina?-1:1):2==a?i=i.sort((e,a)=>e.popularnost>a.popularnost?-1:e.popularnost>a.popularnost?1:0):3==a&&(i=i.sort((e,a)=>e.ocena>a.ocena?-1:e.ocena<a.ocena?1:0))),0==a&&0==e&&(console.log("nule"),i=o),t&&0!=t.length&&(i=i.filter(e=>{for(let a of t)if(e.zanr.includes(a.toString()))return!0})),IspisiPodatke(i,"filmovi",FilmoviDiv)})}function SortirajPoKriterijumu(){SETLocalStorage("filterSort",this.value),filtritajSortiraj()}function filterGodine(){godina=this.value,SETLocalStorage("filterGodina",godina),filtritajSortiraj()}function filterPoZanru(){let e=$(".zanr-check:checked"),a=[];for(let t of e)a.push(t.value.toLowerCase());SETLocalStorage("filterZanr",a),filtritajSortiraj()}function NadjiFilm(){var e=this.value.toLowerCase(),a=document.getElementById("watchListIspis"),t=GETLocalStorage("watchList");ajaxPodaci(function(o){console.log(e),-1!=url.indexOf("bookmark.html")?(o=o.filter(e=>{for(let a of t)if(e.id==a.id)return!0}).filter(a=>a.naziv.toLowerCase().includes(e))).length>0?IspisiPodatke(o,"watchListCard",a):a.innerHTML="<h4 class='text-yellow'>Nema informacija za izabrani sadrzaj!!</h4>":(filtriraniNiz=o.filter(a=>a.naziv.toLowerCase().includes(e)),filtriraniNiz.length>0?(console.log(filtriraniNiz),IspisiPodatke(filtriraniNiz,"filmovi",FilmoviDiv)):(console.log(filtriraniNiz),FilmoviDiv.innerHTML="<h4>Nema informacija za izabrani sadrzaj!!</h4>"))})}function pokreniModal(){var e=this.dataset.film;console.log(this.dataset.film),ajaxPodaci(function(a){a=a.find(a=>a.id==e),document.getElementById("video").setAttribute("src",a.video),document.getElementById("opis").innerHTML=a.opis})}function izvuciGodine(e){e=-1!=url.indexOf("index.html")?e.filter(e=>1==e.kategorijaID).map(e=>e.godina):-1!=url.indexOf("serije.html")?e.filter(e=>2==e.kategorijaID).map(e=>e.godina.pocetak):e.filter(e=>3==e.kategorijaID).map(e=>e.godina);const a=[];for(let t in e)a.includes(e[t])||a.push(e[t]);return a.sort((e,a)=>{if(e<a)return e-a}),a}function MakeProduct(e,a){if("kategorije"==e)return`\n        <li class="nav-item">\n            <a data-link="" href="${a.putanja}" class="h5 nav-link active link-color">${a.naziv}</a>\n        </li>\n    `;if("godineDDL"==e)return`\n            <option value="${a}">${a}</option>\n        `;if("sortDDL"==e)return`\n            <option value="${a.id}">${a.tekst}</option>\n        `;if("filmovi"==e)return`\n        <div class="card bg-black-70 border rounded-xl border-color-yellow border-size-1 mx-1 my-4">\n            <img class="img-thumbnail" src="${a.slika.src}" alt="${a.slika.alt}"/>\n            <a data-film="${a.id}" class="dodajUWatch" href="#"><i class="far fa-bookmark position-absolute"/></i></a>\n            <div class="card-body py-2">\n                <h3 data-film="${a.id}" data-toggle="modal" data-target="#modalYT" class="card-title h5 text-truncate pb-3 mb-1">${a.naziv}</h3>\n                <span class="card-text d-flex text-truncate h6 font-weight-normal">\n                    <p class="border-right border-color-yellow border-size-1 m-0 mr-1 pr-1">${t(a)}</p>\n                    <p class="m-0 text-truncate">${o(a.zanr)}</p>\n                </span>\n                <p class="card-text position-relative"><i class="fas fa-star h4 mr-1"></i><strong>${a.ocena} </strong>/10</p>\n            </div>\n        </div>\n        `;if("zanr"==e)return`\n            <div class="form-check py-1">\n            <input class="zanr-check form-check-input" type="checkbox" name="${a.naziv}" id="${a.naziv}" value="${a.naziv}"/>\n            <label class="form-check-label" for="${a.naziv}">\n                ${a.naziv}\n            </label>                            \n            </div>\n        `;if("watchListCard"==e)return`\n        <div class="align-self-center col-sm-11 col-md-9 col-lg-7 col-xl-5 bg-black-70 my-3 rounded-lg p-2">\n            <div class="d-flex m-0 p-0 m-auto">\n                <div class="col-4 order-md-2 col-sm-4 align-self-center">\n                    <img class="img-WL img-thumbnail rounded-lg" src="${a.slika.src}" alt="${a.slika.alt}"/>\n                </div>\n                <div class="col-7 col-sm-7 order-md-1 ml-0 pl-0 align-self-center">\n                    <div class="card-body p-2">\n                        <h3 data-film="${a.id}" data-toggle="modal" data-target="#modalYT" class="card-title title-WL text-yellow pb-2 mb-1">${a.naziv}</h3>\n                        <span class="card-text d-flex h6 mb-2 wl-span text-pink">\n                            <p class="align-self-center border-right border-color-yellow text-pink border-size-1 m-0 ml-1 mr-1 pr-2">${t(a)}</p>\n                            <p class="align-self-center border-right border-color-yellow text-pink border-size-1 m-0 ml-1 mr-1 pr-2">${function(e){return 0==e.trajanje.minut?e.trajanje.sat+"h":0==e.trajanje.sat?e.trajanje.minut+"min":e.trajanje.sat+"h "+e.trajanje.minut+"min"}(a)}</p>\n                            <p class="card-text position-relative ml-1"><i class="fas fa-star mr-1 mb-0"></i><strong>${a.ocena}</strong>/10</p>\n                        </span>\n                        <p class="infoZanr m-0 h6 text-yellow text-truncate">${o(a.zanr)}</p>\n                        <p class="infoOpis mt-2 font-weight-light text-pink flex-wrap">${a.opis}</p>\n                    </div>\n                </div>\n                <div class="col-1 order-1 order-md-3 col-sm-1 align-self-start mt-3">\n                    <button type="button" data-film="${a.id}" class="link-color close remove" aria-label="Close">\n                    <span aria-hidden="true">&times;</span>\n                </div>\n            </div>    \n        </div>\n        `;function t(e){return 2==e.kategorijaID?0==e.godina.kraj?e.godina.pocetak+" - ":e.godina.pocetak+" - "+e.godina.kraj:e.godina}function o(e){let a="";for(let t=0;t<e.length;t++)t==e.length-1?a+=e[t]:a+=e[t]+", ";return a}}function proveraLog(e){var a,t;e.preventDefault(),a=document.getElementById("emailLog").value,t=document.getElementById("pass").value;let o=!1;rePassword.test(t)&&""!=t?$("#pass").css("border-color","#08b108").next().text(" "):$("#pass").css("border-color","#ee0f0f").next().text("Šifra ili korisničko ime se ne poklapaju!"),reEmail.test(a)?($("#emailLog").css("border-color","#08b108"),o=!0):$("#emailLog").css("border-color","#ee0f0f").attr("placeholder","eg. nebojsa@gmail.com"),o&&(window.location.href="http://localhost/FilmotekaPokusajSort/index.html")}function proverRegister(e){var a,t,o;e.preventDefault(),a=document.getElementById("name").value,t=document.getElementById("emailReg").value,o=document.getElementById("password").value,passCheck=document.getElementById("passwordRepeat").value,console.log(o),console.log(passCheck);let i=!0;/^[A-ZČĆŽŠĐ][a-zčćžšđ]{2,20}(\s[A-ZČĆŽŠĐ][a-zčćžšđ]{2,20})+$/.test(a)?$("#name").css("border-color","#08b108"):($("#name").css("border-color","#ee0f0f").attr("placeholder","eg. Nebojsa Glogovac"),i=!1),rePassword.test(o)&&""!=o?$("#password").css("border-color","#08b108").next().text(" "):($("#password").css("border-color","#ee0f0f").next().text("Šifra mora sadržati jedno: veliko slovo, malo slovo, broj i sadržati 8-15 karaktera!"),i=!1),reEmail.test(t)?$("#emailReg").css("border-color","#08b108"):($("#emailReg").css("border-color","#ee0f0f").attr("placeholder","eg. nebojsa@gmail.com"),i=!1),rePassword.test(passCheck)||""!=passCheck?passCheck!=o?($("#passwordRepeat").css("border-color","#ee0f0f").next().text("Lozinka se ne pokpala!"),i=!1):$("#passwordRepeat").css("border-color","#08b108").next().text(" "):($("#passwordRepeat").css("border-color","#ee0f0f").next().text("Morate popuniti i ovo polje!"),i=!1),i&&($("#passwordRepeat").next().text("Uspesno ste se registrovali!"),window.location.href="http://localhost/FilmotekaPokusajSort/index.html")}function PromeniCSSPoVeliciniEkrana(){console.log(screen.width),screen.width<520?($("#logo").addClass("col-12"),$("#inputSearch").addClass("col-8")):($("#logo").removeClass("col-12"),$("#inputSearch").removeClass("col-8")),screen.width<390?$("#seeFilter").addClass("h4"):$("#seeFilter").removeClass("h4"),screen.width<940&&screen.width>768?$("#zanrovi").removeClass("row-cols-2").addClass("row-cols-1"):$("#zanrovi").removeClass("row-cols-1").addClass("row-cols-2")}reEmail=/^([a-z]{3,}\d{0,}\@((gmail|yahoo)\.com)|ict\.edu\.rs)|([a-z]{3,}\d{0,}\.[a-z]{3,}\d{0,}\@((gmail|yahoo)\.com)|ict\.edu\.rs)$/,rePassword=/^(?:(?=.*\d)(?=.*[a-z])(?=.*[A-Z]).{8,15})$/;
